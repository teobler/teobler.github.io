<!DOCTYPE html>


  <html lang="zh-CN" class="light page-post">


<head>
  <meta charset="utf-8">
  <meta http-equiv="content-language" content="zh-CN">
  
  <title>Webpack原理(3) — 核心概念 | teobler&#39;s blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="webpack," />
  

  <meta name="360-site-verification" content="7b29d0e6eb0d7a16d22f9d0961882c3a" />
  <meta name="sogou_site_verification" content="S1EAZKO83i"/>

  <meta name="description" content="Entry我们先来看一张图  从这张图可以看到，最上面的文件就是我们整个app的入口，也是这个文件启动了我们整个app，这就是weback的入口，通常这个文件会依赖我们自己app的其他文件，其他文件又会依赖别的第三方库，这些依赖可能是js，也可能是css，当然右边也展示了我们也会依赖app里面的其他文件。 在webpack的config文件中，我们使用entry字段来设置这个入口: 12345mo">
<meta name="keywords" content="webpack">
<meta property="og:type" content="article">
<meta property="og:title" content="Webpack原理(3) — 核心概念">
<meta property="og:url" content="https://teobler.com/20200222-webpack-core-concepts.html">
<meta property="og:site_name" content="teobler&#39;s blog">
<meta property="og:description" content="Entry我们先来看一张图  从这张图可以看到，最上面的文件就是我们整个app的入口，也是这个文件启动了我们整个app，这就是weback的入口，通常这个文件会依赖我们自己app的其他文件，其他文件又会依赖别的第三方库，这些依赖可能是js，也可能是css，当然右边也展示了我们也会依赖app里面的其他文件。 在webpack的config文件中，我们使用entry字段来设置这个入口: 12345mo">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://teobler-image.s3-us-west-1.amazonaws.com/webpack-entry.png">
<meta property="og:image" content="https://teobler-image.s3-us-west-1.amazonaws.com/webpack-output.png">
<meta property="og:image" content="https://teobler-image.s3-us-west-1.amazonaws.com/webpack-loaders.png">
<meta property="og:image" content="https://teobler-image.s3-us-west-1.amazonaws.com/webpack-plugin.png">
<meta property="og:updated_time" content="2020-02-22T08:57:34.927Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Webpack原理(3) — 核心概念">
<meta name="twitter:description" content="Entry我们先来看一张图  从这张图可以看到，最上面的文件就是我们整个app的入口，也是这个文件启动了我们整个app，这就是weback的入口，通常这个文件会依赖我们自己app的其他文件，其他文件又会依赖别的第三方库，这些依赖可能是js，也可能是css，当然右边也展示了我们也会依赖app里面的其他文件。 在webpack的config文件中，我们使用entry字段来设置这个入口: 12345mo">
<meta name="twitter:image" content="https://teobler-image.s3-us-west-1.amazonaws.com/webpack-entry.png">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  

  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-158204206-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-158204206-1');
</script>



  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>


  
  <script src="https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba" id="sozz"></script>



  
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  <script data-ad-client="ca-pub-8160236896214353" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">导航</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">导航</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/categories/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tags/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            搜索
          </a>
        </li>
      
    </ul>
  </div>


</div>

<div id="post-container" class="container">
  <div class="content content-post CENTER">
     <article id="post-20200222-webpack-core-concepts" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">Webpack原理(3) — 核心概念</h1>

    <div class="article-meta">
       <div>
          <span>
            <i class="icon-calendar"></i>
            <span>2020.02.22</span>
          </span>

          
            <span class="article-author">
              <i class="icon-user"></i>
              <span>teobler</span>
            </span>
          

          
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/技术/">技术</a>
  </span>



          
            <span>
              <i class="icon-comment"></i>
              <a href="https://teobler.com/20200222-webpack-core-concepts.html#disqus_thread"></a>
            </span>
          

          
          <i class="fa fa-eye"></i>
            <span id="busuanzi_container_page_pv">
               &nbsp热度 <span id="busuanzi_value_page_pv">
               <i class="fa fa-spinner fa-spin"></i></span>℃
            </span>
          

          
      </div>

      <div>
        <i class="icon-text"></i>
        <span class="post-count">全篇字数: 2k</span>
        &nbsp
        <i class="icon-calendar-1"></i>
        <span class="post-count">预计花费: 8分钟</span>
      </div>
      
    </div>
  </header>

  <div class="article-content">
    
      <h2 id="Entry"><a href="#Entry" class="headerlink" title="Entry"></a>Entry</h2><p>我们先来看一张图</p>
<p><img src="https://teobler-image.s3-us-west-1.amazonaws.com/webpack-entry.png" alt="webpack-entry"></p>
<p>从这张图可以看到，最上面的文件就是我们整个app的入口，也是这个文件启动了我们整个app，这就是weback的入口，通常这个文件会依赖我们自己app的其他文件，其他文件又会依赖别的第三方库，这些依赖可能是js，也可能是css，当然右边也展示了我们也会依赖app里面的其他文件。</p>
<p>在webpack的config文件中，我们使用entry字段来设置这个入口:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	...</span><br><span class="line">	entry: <span class="string">"./main.js"</span>,</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一句话来总结就是</p>
<blockquote>
<p>Entry tells webpack <strong>WHAT</strong>(files) to load for the browser</p>
</blockquote>
<h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p><img src="https://teobler-image.s3-us-west-1.amazonaws.com/webpack-output.png" alt="webpack-output"></p>
<p>图片中入口文件下方的是入口文件的依赖，上方就是bundle之后的输出，同样的，我们在config文件中可以通过output这个字段来设置相应的配置项: </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	...</span><br><span class="line">	output: &#123;</span><br><span class="line">		path: <span class="string">"./dist"</span>,</span><br><span class="line">		filename: <span class="string">"./bundle.js"</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个配置就是在告诉webpack编译后的文件应该放在哪里，文件名应该叫什么，一句话总结</p>
<blockquote>
<p>Output tells webpack <strong>WHERE</strong> and <strong>HOW</strong> to discribute bundles. It works with Entry.</p>
</blockquote>
<h2 id="Loaders-amp-Rules"><a href="#Loaders-amp-Rules" class="headerlink" title="Loaders &amp; Rules"></a>Loaders &amp; Rules</h2><p>需要明白的是，loaders都是一些JS的modules，也就是说都是一些JS的方法(functions)，他们以你app的module作为输入，返回一个修改后的状态，这些loaders会在webpack建立依赖图的时候对每一个文件进行相应的处理:</p>
<p><img src="https://teobler-image.s3-us-west-1.amazonaws.com/webpack-loaders.png" alt="webpack-loaders"></p>
<p>比如第一个ts-loader就是在说告诉webpack，任何时候你想要把一个ts文件放入依赖图中，就用ts-loader处理一次，处理过后这个文件就被编译成了js文件，当然，可能这个文件也有别的依赖，会按照相同的方式依次进行处理。</p>
<p>通常这个字段接收这些参数:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	rules: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 告诉编译器要编译哪些文件</span></span><br><span class="line">			test: regex,</span><br><span class="line">			<span class="comment">// loader(s)</span></span><br><span class="line">			use: (<span class="built_in">Array</span> | <span class="built_in">String</span> | <span class="built_in">Function</span>),</span><br><span class="line">			<span class="comment">// 白名单</span></span><br><span class="line">			include: <span class="built_in">RegExp</span>[],</span><br><span class="line">			<span class="comment">// 黑名单</span></span><br><span class="line">			exclude: <span class="built_in">RegExp</span>[],</span><br><span class="line">			<span class="comment">// 告诉webpack这条规则是否在其他规则 之前 | 之后 运行</span></span><br><span class="line">			enforce: <span class="string">"pre"</span> | <span class="string">"post"</span></span><br><span class="line">		&#125;,</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Chaining-Loaders"><a href="#Chaining-Loaders" class="headerlink" title="Chaining Loaders"></a>Chaining Loaders</h3><p>在上面的介绍中可以看到<code>use</code>字段是可以传入一个数组的，比如<code>[&quot;style&quot;, &quot;css&quot;, &quot;less&quot;]</code>但是需要指出的是，这三个loaders是按照从右到左的的顺序来执行的，这个规则将使一个less文件编译成一个css文件，再由css编译成js文件，最后编译成一个能够在浏览器中运行的<code>inline style</code>的js文件。</p>
<blockquote>
<p>loaders tells webpack HOW to interpret and translate files. Transformed on a per-file basis before adding to dependency graph</p>
</blockquote>
<h2 id="Plugin"><a href="#Plugin" class="headerlink" title="Plugin"></a>Plugin</h2><p>对于webpack来说，插件是什么：</p>
<ul>
<li>一个对象，这个对象上有一个<code>apply</code>属性</li>
<li>允许你在编译的生命周期里做一些事情(hook)</li>
<li>webpack有各种各样的内置插件</li>
</ul>
<p>一个简单的例子，编译器用这个插件分发事件：</p>
<p><img src="https://teobler-image.s3-us-west-1.amazonaws.com/webpack-plugin.png" alt="webpack-plugin"></p>
<p>这个插件被作为一个实例传入了webpack，所以它可以hook进不同的事件中(这里的代码是webpack3的，因为这里只讲概念，所以问题不大)。</p>
<p>首先这个插件插入编译器后悔监听<code>done</code>这个事件，这个事件会给这个插件传入一个参数，这里是一个<code>state</code>然后插件在这个state的基础上做出一些反应和处理（这里只是在控制台里输出了一个字符），下面的也是同样的，不过这次这个事件换成了<code>failed</code></p>
<p>可以看到插件的定义是这样的，所以它可以被实例化，于是在webpack的config文件中我们就会这样去使用它:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> BellOnBundlerErrorPlugin = <span class="built_in">require</span>(<span class="string">"bell-on-error"</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	...</span><br><span class="line">	plugins: [</span><br><span class="line">			<span class="keyword">new</span> BellOnBundlerErrorPlugin(),</span><br><span class="line">			<span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(<span class="string">"vendors"</span>),</span><br><span class="line">	],</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有意思的是，webpack的源代码有80%左右都是由plugins组成的，webpack是一个完全由事件驱动的体系结构，这也就可以使用插件迅速为webpack增添新的功能，并且不会破坏原有的功能，同样的也能够删除一些不必要的功能。</p>
<blockquote>
<p>Adds additional functionality to Compilations(optimized bundled modules). More powerful more access to CompilerAPI. Does everything else you’d ever want to in webpack.</p>
</blockquote>
<p>plugin与loader的最大不同就是loader是通过去访问一个个文件去做一些事情的，但是plugin可以访问webpack的事件生命周期和运行时，并且可以访问所有bundle文件。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>讲了这么多我们总得用概念做点什么</p>
<blockquote>
<p>以下代码位于 <code>feature/04010-composing-configs-webpack-merge</code> 分支</p>
</blockquote>
<h3 id="读取命令行中的参数"><a href="#读取命令行中的参数" class="headerlink" title="读取命令行中的参数"></a>读取命令行中的参数</h3><p>我们可以将<code>package.json</code>中的命令做一个修改，传入一个env变量，带有一个mode属性: </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"script"</span> &#123;</span><br><span class="line">	<span class="attr">"webpack"</span>: <span class="string">"webpack"</span>,</span><br><span class="line">	<span class="attr">"dev"</span>: <span class="string">"npm run webpack -- --env.mode development"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在<code>webpack.config.js</code>中我们可以这样获取到这个变量:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">env</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(env);</span><br><span class="line">	<span class="comment">// &#123; mode: "development" &#125;</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		mode: env.mode,</span><br><span class="line">		output: &#123;</span><br><span class="line">			filename: <span class="string">"bundle.js"</span>,</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="加插件"><a href="#加插件" class="headerlink" title="加插件"></a>加插件</h3><p>我们这里以一个很通用并且很重要的插件<code>html-webpack-plugin</code>为例</p>
<p>首先用<code>yarn add html-webpack-plugin —dev</code>安装插件，然后在config文件中配置:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">env</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(env);</span><br><span class="line">	<span class="comment">// &#123; mode: "development" &#125;</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		mode: env.mode,</span><br><span class="line">		output: &#123;</span><br><span class="line">			filename: <span class="string">"bundle.js"</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">		plugins: [<span class="keyword">new</span> HtmlWebpackPlugin()],</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后再运行<code>yarn dev</code>，你会发现bundle里面多了一个<code>index.html</code>文件，文件中用script标签把已经打包好的JS代码进行了引入。</p>
<h3 id="设置本地开发服务"><a href="#设置本地开发服务" class="headerlink" title="设置本地开发服务"></a>设置本地开发服务</h3><p>首先安装server插件<code>yarn add webpack-dev-server --dev</code>,然后修改<code>package.json</code>:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"script"</span> &#123;</span><br><span class="line">	<span class="attr">"webpack-dev-server"</span>: <span class="string">"webpack-dev-server"</span>,</span><br><span class="line">	<span class="attr">"dev"</span>: <span class="string">"npm run webpack-dev-server -- --mode development"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后当你运行<code>yarn dev</code>的时候就会默认在本地8080端口启动一个server，在浏览器访问这个端口你就可以看见刚刚生成的html文件了，而且dev server默认开启了watch模式，可以实时更新代码到server上。</p>
<p>其实大家也能够猜到这个”插件“其实就是启动了一个Express的server，然后webpack在打包的时候直接将生成的文件加载进内存，通过server直接显示在浏览器里。</p>
<h3 id="为不同的环境设置不同的config文件"><a href="#为不同的环境设置不同的config文件" class="headerlink" title="为不同的环境设置不同的config文件"></a>为不同的环境设置不同的config文件</h3><p>我们可以像代码库中一样通过简单的配置使得webpack在得到不同参数的情况下去require不同的webpack config文件，以达到区分dev环境和prod环境的目的:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> webpackMerge = <span class="built_in">require</span>(<span class="string">"webpack-merge"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> modeConfig = <span class="function"><span class="params">env</span> =&gt;</span> <span class="built_in">require</span>(<span class="string">`./build-utils/webpack.<span class="subst">$&#123;env&#125;</span>`</span>)(env);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">&#123; mode, presets &#125; = &#123; mode: <span class="string">"production"</span>, presets: [] &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> webpackMerge(</span><br><span class="line">    &#123;</span><br><span class="line">      mode,</span><br><span class="line">      output: &#123;</span><br><span class="line">        filename: <span class="string">"bundle.js"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      plugins: [<span class="keyword">new</span> HtmlWebpackPlugin(), <span class="keyword">new</span> webpack.ProgressPlugin()]</span><br><span class="line">    &#125;,</span><br><span class="line">    modeConfig(mode)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>但是实际的项目往往要复杂得多，一个大型项目往往不止有两个环境，通常来说<code>development mode</code>下应该有CI Dev QA UAT四个环境，<code>production mode</code>对应Prod环境。</p>
<p>由于在开发时不同的环境又对应不同的config，比如在Dev坏境应该去请求后端的Dev坏境，而不应该去请求QA坏境，这时我们又会引入不同的config文件去实现这一点。</p>
<p>首先安装<code>config</code>这个包，，然后在根目录下新建一个config目录，新建你需要的config文件，这些文件都是JSON格式的，记得建一个<code>default.json</code>，当其找不到对应的坏境时就会默认读取default文件，文件可以长这个样子:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// default.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"API_BASE_URL"</span>: <span class="string">"https://dev.your-project.com"</span>,</span><br><span class="line">  <span class="attr">"AUTH_URL"</span>: <span class="string">"https://dev.your-project.com/auth"</span>,</span><br><span class="line">  <span class="attr">"NODE_ENV"</span>: <span class="string">"dev"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//qa.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"API_BASE_URL"</span>: <span class="string">"https://qa.your-project.com"</span>,</span><br><span class="line">  <span class="attr">"AUTH_URL"</span>: <span class="string">"https://qa.your-project.com/auth"</span>,</span><br><span class="line">  <span class="attr">"NODE_ENV"</span>: <span class="string">"qa"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在运行启动命令的时候加上<code>NODE_ENV</code>这个参数，这样你在webpack的config文件中就可以通过<code>process.env.NODE_ENV</code>去获取这个参数，并且在config文件中可以将之前的config文件require进来在代码中进行使用:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> webpackMerge = <span class="built_in">require</span>(<span class="string">"webpack-merge"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> modeConfig = <span class="function"><span class="params">env</span> =&gt;</span> <span class="built_in">require</span>(<span class="string">`./build-utils/webpack.<span class="subst">$&#123;env&#125;</span>`</span>)(env);</span><br><span class="line"><span class="keyword">const</span> envConfig = <span class="built_in">JSON</span>.stringify(<span class="built_in">require</span>(<span class="string">"config"</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">&#123; mode, presets &#125; = &#123; mode: <span class="string">"production"</span>, presets: [] &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> webpackMerge(</span><br><span class="line">    &#123;</span><br><span class="line">      mode,</span><br><span class="line">      output: &#123;</span><br><span class="line">        filename: <span class="string">"bundle.js"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(), </span><br><span class="line">        <span class="keyword">new</span> webpack.ProgressPlugin(),</span><br><span class="line">        <span class="keyword">new</span> webpack.DefinePlugin(&#123; <span class="attr">CONFIG</span>: envConfig &#125;),</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    modeConfig(mode)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// axios.js</span></span><br><span class="line"><span class="keyword">const</span> client = axios.create(&#123;</span><br><span class="line">  baseURL: CONFIG.API_BASE_URL,</span><br><span class="line">  timeout: <span class="number">10000</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
    
  </div>
</article>

  </div>
  <aside id="aside-bar">
    
  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Entry"><span class="toc-text">Entry</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Output"><span class="toc-text">Output</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Loaders-amp-Rules"><span class="toc-text">Loaders &amp; Rules</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Chaining-Loaders"><span class="toc-text">Chaining Loaders</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Plugin"><span class="toc-text">Plugin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例"><span class="toc-text">示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#读取命令行中的参数"><span class="toc-text">读取命令行中的参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加插件"><span class="toc-text">加插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置本地开发服务"><span class="toc-text">设置本地开发服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#为不同的环境设置不同的config文件"><span class="toc-text">为不同的环境设置不同的config文件</span></a></li></ol></li></ol>
  </div>


    
  <div id="recent-post" class="recent-post">
    <strong class="recent-post-title">
      近期文章
    </strong>
    <ul class="recent-post-list">
      
         <li class="recent-post-list">
           <a href="/20200523-devtool-performance-networking-auditing-and-node.html" title="(2)你真的会用Chrome devtool吗?" >(2)你真的会用Chrome devtool吗?</a>
         </li>
      
         <li class="recent-post-list">
           <a href="/20200516-react-concurrent-mode-suspense.html" title="React Concurrent Mode 之 Suspense 实践" >React Concurrent Mode 之 Suspense 实践</a>
         </li>
      
         <li class="recent-post-list">
           <a href="/20200304-devtool-editing-and-debugging.html" title="(1)你真的会用Chrome devtool吗?" >(1)你真的会用Chrome devtool吗?</a>
         </li>
      
         <li class="recent-post-list">
           <a href="/20200222-webpack-core-concepts.html" title="Webpack原理(3) — 核心概念" >Webpack原理(3) — 核心概念</a>
         </li>
      
         <li class="recent-post-list">
           <a href="/20200219-first-in-webpack.html" title="Webpack原理(2) — 加载原理" >Webpack原理(2) — 加载原理</a>
         </li>
      
         <li class="recent-post-list">
           <a href="/20200211-tdd-with-react-hooks.html" title="用React hooks实现TDD" >用React hooks实现TDD</a>
         </li>
      
         <li class="recent-post-list">
           <a href="/20200107-reduce-bundle-size.html" title="如何减小前端代码打包体积" >如何减小前端代码打包体积</a>
         </li>
      
         <li class="recent-post-list">
           <a href="/20190906-error-handler.html" title="React中的错误处理" >React中的错误处理</a>
         </li>
      
         <li class="recent-post-list">
           <a href="/20190903-compose.html" title="函数式初识(6) - 组合" >函数式初识(6) - 组合</a>
         </li>
      
         <li class="recent-post-list">
           <a href="/20190831-partial-and-currying.html" title="函数式初识(5) - 偏函数和柯里化" >函数式初识(5) - 偏函数和柯里化</a>
         </li>
      
    </ul>
  </div>


  </aside>
</div>




  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/20200219-first-in-webpack.html">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/20200304-devtool-editing-and-debugging.html">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>





  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/categories/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tags/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              搜索
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'teobler';
    
    var disqus_url = 'https://teobler.com/20200222-webpack-core-concepts.html';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//teobler.disqus.com/count.js" async></script>



    




    

    
	
  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
